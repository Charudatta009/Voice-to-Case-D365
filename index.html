<!-- <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Voice to Case - D365 Enhanced</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin-top: 50px; }
    button { padding: 10px 20px; font-size: 16px; margin: 10px; }
    #status { margin-top: 20px; font-size: 16px; }
    #transcript { margin-top: 10px; font-size: 18px; color: #444; white-space: pre-line; }
  </style>
</head>
<body>

  <h2>üé§ Voice-to-Case Generator (D365) - Enhanced</h2>
  <button id="startBtn">Start Recording</button>
  <button id="stopBtn" disabled>Stop Recording</button>
  <p id="status">Status: Idle</p>
  <div id="transcript"></div>

  <script>
    let recognition;
    let isRecording = false;
    let transcriptText = '';

    const startBtn = document.getElementById("startBtn");
    const stopBtn = document.getElementById("stopBtn");
    const status = document.getElementById("status");
    const transcriptDiv = document.getElementById("transcript");

    function initRecognition() {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      const recog = new SpeechRecognition();
      recog.lang = 'en-US';
      recog.continuous = true;
      recog.interimResults = false;

      recog.onresult = (event) => {
        for (let i = event.resultIndex; i < event.results.length; i++) {
          if (event.results[i].isFinal) {
            transcriptText += event.results[i][0].transcript + '\n';
          }
        }
        transcriptDiv.innerText = `You said:\n${transcriptText}`;
      };

      recog.onerror = (event) => {
        console.error("Speech recognition error:", event.error);
        status.innerText = `Error: ${event.error}`;
      };

      recog.onend = () => {
        if (isRecording) {
          console.log("Recognition ended. Restarting...");
          recog.start(); // Restart automatically if still recording
        }
      };

      return recog;
    }

    startBtn.onclick = () => {
      transcriptText = '';
      transcriptDiv.innerText = "";
      status.innerText = "Status: Listening...";
      startBtn.disabled = true;
      stopBtn.disabled = false;
      isRecording = true;

      recognition = initRecognition();
      recognition.start();
    };

    stopBtn.onclick = () => {
      isRecording = false;
      recognition.stop();
      startBtn.disabled = false;
      stopBtn.disabled = true;
      status.innerText = "Status: Processing...";

      setTimeout(() => {
        transcriptDiv.innerText = `You said:\n${transcriptText}`;

        if (!transcriptText.trim()) {
          status.innerText = "‚ùå No speech detected.";
          return;
        }

        sendToBackend(transcriptText);
      }, 1000);
    };

    async function sendToBackend(text) {
      try {
        console.log("Sending transcript:", text); // Debug log
        const response = await fetch("https://voice-to-case-d365.onrender.com/transcribe", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ transcript: text })
        });

        const result = await response.json();
        console.log("Backend response:", result);

        if (response.ok) {
          status.innerText = `‚úÖ Case created! Sentiment: ${result.sentiment}, Priority: ${result.priority}`;
        } else {
          status.innerText = `‚ùå Failed: ${result.error}`;
        }
      } catch (error) {
        status.innerText = `‚ùå Error: ${error.message}`;
      }
    }
  </script>
</body>
</html>
 -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Voice to Case - D365 Enhanced</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
</head>
<body>
  <div class="container">
    <div class="card">
      <div class="header">
        <i class="fas fa-microphone-alt pulse"></i>
        <h1>Voice-to-Case Generator</h1>
        <h2>Dynamics 365 Enhanced</h2>
      </div>
      
      <div class="controls">
        <button id="startBtn" class="btn record-btn">
          <i class="fas fa-microphone"></i> Start Recording
        </button>
        <button id="stopBtn" class="btn stop-btn" disabled>
          <i class="fas fa-stop"></i> Stop Recording
        </button>
      </div>
      
      <div class="status-container">
        <div id="status" class="status">
          <i class="fas fa-circle-notch fa-spin"></i> Status: Idle
        </div>
      </div>
      
      <div class="transcript-container">
        <div id="transcript" class="transcript"></div>
      </div>
      
      <div class="wave-animation">
        <div class="wave"></div>
        <div class="wave"></div>
        <div class="wave"></div>
      </div>
    </div>
  </div>

  <script src="script.js"></script>
</body>
</html>
 
